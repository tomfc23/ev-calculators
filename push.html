<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pool EV Calculator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
      color: #ffffff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      min-height: 100vh;
      padding: 2rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 300;
      margin-bottom: 1rem;
      background: linear-gradient(45deg, #8B5CF6, #06B6D4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    h4 {
      text-align: center;
      margin-bottom: 1rem;
      background: linear-gradient(45deg, #8B5CF6, #06B6D4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .instructions {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      backdrop-filter: blur(10px);
    }

    .instructions h3 {
      color: #ffffff;
      margin-bottom: 1rem;
      font-weight: 500;
    }

    .instructions ol {
      color: #b3b3b3;
      padding-left: 1.5rem;
    }

    .instructions li {
      margin-bottom: 0.5rem;
      line-height: 1.5;
    }

    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .game-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1.5rem;
      backdrop-filter: blur(10px);
    }

    .game-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #ffffff;
      text-align: center;
    }

    .team-row {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .team-section {
      flex: 1;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 8px;
      padding: 1rem;
    }

    .team-name {
      font-size: 0.9rem;
      font-weight: 500;
      color: #ffffff;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .input-group {
      margin-bottom: 0.8rem;
    }

    .input-label {
      display: block;
      font-size: 0.8rem;
      color: #b3b3b3;
      margin-bottom: 0.3rem;
    }

    .input-field {
      width: 100%;
      padding: 0.6rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      color: #ffffff;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
    }

    .odds-display {
      font-size: 0.75rem;
      color: #888;
      margin-top: 0.3rem;
      text-align: center;
    }
.copy-btn {
  background: linear-gradient(45deg, #10b981, #059669);
  border: none;
  padding: 0.6rem 1.5rem;
  color: white;
  font-size: 0.9rem;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-left: 1rem;
}

.copy-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}

.copy-btn:active {
  transform: translateY(0);
}
    .controls {
      display: flex;
      gap: 1rem;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .control-group {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 1rem;
      backdrop-filter: blur(10px);
    }

    .control-group label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #ffffff;
      font-size: 0.9rem;
    }

    .control-group input[type="number"] {
      width: 80px;
      padding: 0.4rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      color: #ffffff;
      font-size: 0.9rem;
    }

    .control-group input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: #8B5CF6;
    }

    .calculate-btn {
      background: linear-gradient(45deg, #8B5CF6, #06B6D4);
      border: none;
      padding: 0.8rem 2rem;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .calculate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
    }

    .results-btn {
       background: linear-gradient(45deg, #10b981, #059669);
      border: none;
      padding: 0.8rem 2rem;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .results-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }


    .results-section {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      backdrop-filter: blur(10px);
    }

    .results-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #ffffff;
      text-align: center;
    }

    .info-note {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .info-note p {
      color: #b3b3b3;
      font-size: 0.9rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 8px;
      overflow: hidden;
    }

    th {
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
      padding: 1rem 0.8rem;
      text-align: center;
      font-weight: 600;
      font-size: 0.9rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    td {
      padding: 0.8rem;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      color: #e0e0e0;
      font-size: 0.85rem;
    }

    tr:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .ev-positive {
      color: #4ade80;
      font-weight: 600;
    }

    .ev-negative {
      color: #f87171;
      font-weight: 600;
    }

    .extras-table {
      margin-top: 2rem;
    }

    @media (max-width: 768px) {
      .games-grid {
        grid-template-columns: 1fr;
      }
      
      .team-row {
        flex-direction: column;
      }
      
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      body {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Pool EV Calculator</h1>
    <h4>Major props to @xpr0gidy, he helped a lot with developement</h4>
    <div class="instructions">
      <h3>Instructions</h3>
      <ol>
        <li>Enter the details for each of the 4 games including odds (American format), and selection percentages.</li>
        <li>For each game, select .5 Spread (no push) or .0 Spread (push possible).</li>
        <li>For .0 spreads, enter the win probabilities for the adjusted lines (e.g., -7.5 and +8.5 for a -8.0 spread).</li>
        <li>Click "Calculate" to see all combinations with their expected values, probabilities, and potential payouts.</li>
        <li>Total pool entrants is set to 4600. Payouts are capped at 800 karma for 4/4 and 600 karma for 3/4.</li>
        <li>To use the calculator mid-game, put like -99999 for winners and +99999 for losers, put in the percentages, and see what the new results are</li>
        <li><strong>Push Logic:</strong> When a push occurs, BOTH sides are awarded a win for that leg (increases winner counts and lowers payouts).</li>
      </ol>
    </div>

    <div class="games-grid" id="inputs"></div>

    <div class="controls">
      <div class="control-group">
        <label>Total Entrants: <input type="number" id="totalEntrants" value="4600" /></label>
      </div>
      <div class="control-group">
        <label><input type="checkbox" id="showExtras"> Show odds, probabilities, payouts</label>
      </div>
      <button class="calculate-btn" onclick="calculateEV()">Calculate Results</button>
    </div>

    <div class="results-section" id="results-container" style="display: none;">
      <div class="info-note">
        <p><strong>Win Probabilities Based On:</strong><br>
        No-vig odds are used for calculations to remove bookmakers' edge. Push probabilities are calculated for .0 spreads.<br>
        <strong>Push Rule:</strong> When a push occurs, both L and R picks are considered correct for that game.</p>
      </div>
      <h3 class="results-title">All Combinations and Payouts</h3>
      <div id="results"></div>
    </div>

    <div class="results-section extras-table" id="extras-container" style="display: none;">
      <div id="extras"></div>
    </div>
  </div>

  <script>
    const inputContainer = document.getElementById('inputs');
    for (let i = 0; i < 4; i++) {
      inputContainer.innerHTML += `
        <div class="game-card">
          <div class="game-title">Game ${i + 1}</div>
          <div class="spread-selector">
            <label>Spread Type: </label>
            <select id="spreadType${i}" onchange="togglePushInputs(${i})">
              <option value="0.5">.5 Spread (No Push)</option>
              <option value="0.0">.0 Spread (Push Possible)</option>
            </select>
          </div>
          <div class="team-row">
            <div class="team-section">
              <div class="team-name">L${i + 1}</div>
              <div class="input-group">
                <label class="input-label">American Odds</label>
                <input class="input-field" id="oddsL${i}" type="number" value="-110" oninput="updateOddsDisplay(${i}, 'L')">
                <div class="odds-display" id="oddsDisplayL${i}">No-Vig Odds: -110<br>No-Vig Probability: 50.0%</div>
              </div>
              <div class="input-group">
                <label class="input-label">Selection %</label>
                <input class="input-field" id="pickL${i}" type="number" value="50" oninput="autofillRightPercents()">
              </div>
              <div class="push-inputs" id="pushInputsL${i}" style="display: none;">
                <div class="input-group">
                  <label class="input-label">American Odds (e.g., -115 for -7.5)</label>
                  <input class="input-field" id="pushOddsL${i}" type="number" value="-110" oninput="updatePushDisplay(${i})" onkeyup="updatePushDisplay(${i})">
                </div>
              </div>
            </div>
            <div class="team-section">
              <div class="team-name">R${i + 1}</div>
              <div class="input-group">
                <label class="input-label">American Odds</label>
                <input class="input-field" id="oddsR${i}" type="number" value="-110" oninput="updateOddsDisplay(${i}, 'R')">
                <div class="odds-display" id="oddsDisplayR${i}">No-Vig Odds: -110<br>No-Vig Probability: 50.0%</div>
              </div>
              <div class="input-group">
                <label class="input-label">Selection %</label>
                <input class="input-field" id="pickR${i}" type="number" value="50" oninput="autofillRightPercents()">
              </div>
              <div class="push-inputs" id="pushInputsR${i}" style="display: none;">
                <div class="input-group">
                  <label class="input-label">American Odds (e.g., -105 for +8.5)</label>
                  <input class="input-field" id="pushOddsR${i}" type="number" value="-110" oninput="updatePushDisplay(${i})" onkeyup="updatePushDisplay(${i})">
                </div>
              </div>
            </div>
          </div>
          <div class="push-inputs" id="pushDisplay${i}" style="display: none;">
            <div style="text-align: center; font-weight: 600; color: #856404;">
              Push Probability: <span id="pushProb${i}">0.0%</span>
            </div>
          </div>
        </div>
      `;
    }

    function americanToImplied(odds) {
      return odds < 0 ? (-odds) / (-odds + 100) : 100 / (odds + 100);
    }

    function calculateNoVigProb(p1, p2) {
      const total = p1 + p2;
      return [p1 / total, p2 / total];
    }

    function togglePushInputs(gameIndex) {
      const spreadType = document.getElementById(`spreadType${gameIndex}`).value;
      const pushInputsL = document.getElementById(`pushInputsL${gameIndex}`);
      const pushInputsR = document.getElementById(`pushInputsR${gameIndex}`);
      const pushDisplay = document.getElementById(`pushDisplay${gameIndex}`);
      
      if (spreadType === '0.0') {
        pushInputsL.style.display = 'block';
        pushInputsR.style.display = 'block';
        pushDisplay.style.display = 'block';
        updatePushDisplay(gameIndex);
      } else {
        pushInputsL.style.display = 'none';
        pushInputsR.style.display = 'none';
        pushDisplay.style.display = 'none';
      }
      updateOddsDisplay(gameIndex, 'L');
    }

    function updatePushDisplay(gameIndex) {
      const oddsL = parseFloat(document.getElementById(`pushOddsL${gameIndex}`).value) || -110;
      const oddsR = parseFloat(document.getElementById(`pushOddsR${gameIndex}`).value) || -110;
      
      // Convert American odds to implied probabilities
      const impL = americanToImplied(oddsL);
      const impR = americanToImplied(oddsR);
      
      // Calculate push probability as the excess probability above 1
      const totalImplied = impL + impR;
      const pushProb = Math.max(0, totalImplied - 1);
      
      // Normalize all probabilities to sum to 1 (same as main calculation)
      const totalProb = impL + impR + pushProb;
      const normalizedPushProb = pushProb / totalProb;
      
      // Cap at reasonable levels after normalization
      const finalPushProb = Math.min(Math.max(normalizedPushProb, 0.01), 0.15);
      
      document.getElementById(`pushProb${gameIndex}`).textContent = `${(finalPushProb * 100).toFixed(1)}%`;
      
      // Also update the odds displays to show the live values
      updateOddsDisplay(gameIndex, 'L');
    }

    function updateOddsDisplay(gameIndex, side) {
      const spreadType = document.getElementById(`spreadType${gameIndex}`).value;
      
      if (spreadType === '0.0') {
        // For .0 spreads, show the raw probabilities (don't remove vig)
        const oddsL = parseFloat(document.getElementById(`pushOddsL${gameIndex}`).value) || -110;
        const oddsR = parseFloat(document.getElementById(`pushOddsR${gameIndex}`).value) || -110;
        
        const impL = americanToImplied(oddsL);
        const impR = americanToImplied(oddsR);
        
        // Calculate push probability and normalize all probabilities
        const totalImplied = impL + impR;
        const pushProb = Math.max(0, totalImplied - 1);
        const totalProb = impL + impR + pushProb;
        
        const probL = impL / totalProb;
        const probR = impR / totalProb;
        const normalizedPushProb = pushProb / totalProb;
        
        document.getElementById(`oddsDisplayL${gameIndex}`).innerHTML = 
          `Odds: ${oddsL}<br>Win Prob: ${(probL * 100).toFixed(1)}%<br>Push Prob: ${(normalizedPushProb * 100).toFixed(1)}%`;
        document.getElementById(`oddsDisplayR${gameIndex}`).innerHTML = 
          `Odds: ${oddsR}<br>Win Prob: ${(probR * 100).toFixed(1)}%<br>Push Prob: ${(normalizedPushProb * 100).toFixed(1)}%`;
      } else {
        // Regular .5 spread logic
        const lOdds = parseFloat(document.getElementById(`oddsL${gameIndex}`).value) || -110;
        const rOdds = parseFloat(document.getElementById(`oddsR${gameIndex}`).value) || -110;
        
        const impL = americanToImplied(lOdds);
        const impR = americanToImplied(rOdds);
        const [probL, probR] = calculateNoVigProb(impL, impR);
        
        document.getElementById(`oddsDisplayL${gameIndex}`).innerHTML = 
          `No-Vig Odds: ${lOdds}<br>No-Vig Probability: ${(probL * 100).toFixed(1)}%`;
        document.getElementById(`oddsDisplayR${gameIndex}`).innerHTML = 
          `No-Vig Odds: ${rOdds}<br>No-Vig Probability: ${(probR * 100).toFixed(1)}%`;
      }
    }

    // Initialize odds displays
    for (let i = 0; i < 4; i++) {
      updateOddsDisplay(i, 'L');
    }

    function generateAllOutcomes(gameTypes) {
      // Generate all possible outcomes considering push possibilities
      let outcomes = [''];
      
      for (let i = 0; i < 4; i++) {
        const newOutcomes = [];
        if (gameTypes[i] === '0.0') {
          // .0 spread: L, R, P (push)
          outcomes.forEach(outcome => {
            newOutcomes.push(outcome + '0'); // L
            newOutcomes.push(outcome + '1'); // R  
            newOutcomes.push(outcome + 'P'); // Push
          });
        } else {
          // .5 spread: L, R only
          outcomes.forEach(outcome => {
            newOutcomes.push(outcome + '0'); // L
            newOutcomes.push(outcome + '1'); // R
          });
        }
        outcomes = newOutcomes;
      }
      
      return outcomes;
    }

    function calculateMatches(userPick, outcome) {
      let matches = 0;
      for (let i = 0; i < 4; i++) {
        const userChoice = userPick[i];
        const gameOutcome = outcome[i];
        
        if (gameOutcome === 'P') {
          // Push - BOTH sides are considered correct (user gets this pick right regardless of what they picked)
          matches++;
        } else if (userChoice === gameOutcome) {
          // Exact match - user picked the correct side
          matches++;
        }
      }
      return matches;
    }

    function calculateEV() {
      const totalEntrants = parseInt(document.getElementById('totalEntrants').value);
      const showExtras = document.getElementById('showExtras').checked;
      let pickPercents = [], winProbs = [], gameTypes = [], extraData = [];

      for (let i = 0; i < 4; i++) {
        let lPick = parseFloat(document.getElementById(`pickL${i}`).value) / 100;
        let rPick = parseFloat(document.getElementById(`pickR${i}`).value) / 100;
        const spreadType = document.getElementById(`spreadType${i}`).value;
        
        pickPercents.push([lPick, rPick]);
        gameTypes.push(spreadType);

        if (spreadType === '0.0') {
          // .0 spread - use raw implied probabilities (don't remove vig)
          const oddsL = parseFloat(document.getElementById(`pushOddsL${i}`).value);
          const oddsR = parseFloat(document.getElementById(`pushOddsR${i}`).value);
          
          const impL = americanToImplied(oddsL);
          const impR = americanToImplied(oddsR);
          
          // Don't use no-vig calculation - use raw implied probabilities
          // The push probability is the excess probability above 1
          const totalImplied = impL + impR;
          const pushProb = Math.max(0, totalImplied - 1);
          
          // Normalize so all probabilities sum to 1
          const totalProb = impL + impR + pushProb;
          const probL = impL / totalProb;
          const probR = impR / totalProb;
          const normalizedPushProb = pushProb / totalProb;
          
          winProbs.push([probL, probR, normalizedPushProb]);
          extraData.push({ 
            type: '0.0', 
            oddsL: oddsL,
            oddsR: oddsR,
            winL: probL * 100, 
            winR: probR * 100, 
            pushProb: normalizedPushProb * 100 
          });
        } else {
          // .5 spread - regular no-vig calculation
          let lOdds = parseFloat(document.getElementById(`oddsL${i}`).value);
          let rOdds = parseFloat(document.getElementById(`oddsR${i}`).value);
          
          const impL = americanToImplied(lOdds);
          const impR = americanToImplied(rOdds);
          const [probL, probR] = calculateNoVigProb(impL, impR);
          winProbs.push([probL, probR]);
          extraData.push({ 
            type: '0.5', 
            lOdds, 
            rOdds, 
            impL, 
            impR, 
            probL, 
            probR 
          });
        }
      }

      // Generate all possible outcomes (including pushes)
      const allOutcomes = generateAllOutcomes(gameTypes);
      
      // Generate all user pick combinations (still 16 for 4 games)
      const userCombos = Array.from({length: 16}, (_, i) => i.toString(2).padStart(4, '0'));
      
      // Calculate selection counts for each user combo
      let counts = {};
      userCombos.forEach(combo => {
        let prob = 1;
        for (let i = 0; i < 4; i++) {
          let pick = +combo[i];
          prob *= pickPercents[i][pick];
        }
        counts[combo] = (totalEntrants - 1) * prob;
      });

      let results = [];
      window.winProbs = winProbs;
      window.gameTypes = gameTypes;

      userCombos.forEach(userPick => {
        let EV = 0;
        let pickProb = 1;
        for (let i = 0; i < 4; i++) pickProb *= pickPercents[i][+userPick[i]];

        allOutcomes.forEach(outcome => {
          // Calculate outcome probability
          let p = 1;
          for (let i = 0; i < 4; i++) {
            const gameOutcome = outcome[i];
            if (gameOutcome === 'P') {
              p *= winProbs[i][2]; // Push probability
            } else {
              p *= winProbs[i][+gameOutcome];
            }
          }

          // Calculate matches for this user pick vs outcome
          const matches = calculateMatches(userPick, outcome);
          const isTier1 = matches === 4;
          const isTier2 = matches === 3;

          // Count winners in each tier for this outcome
          let w1 = 0; // 4/4 winners
          let w2 = 0; // 3/4 winners

          userCombos.forEach(otherCombo => {
            const otherMatches = calculateMatches(otherCombo, outcome);
            const comboCount = counts[otherCombo] || 0;
            
            if (otherMatches === 4) {
              w1 += comboCount;
            } else if (otherMatches === 3) {
              w2 += comboCount;
            }
          });

          // Add current user if they qualify
          if (userPick === userPick) { // Always true, but keeping structure
            const userMatches = calculateMatches(userPick, outcome);
            if (userMatches === 4) w1++;
            if (userMatches === 3) w2++;
          }

          // Calculate payout
          const pool = 100 * totalEntrants;
          const shares = w1 + 0.5 * w2;
          const shareValue = shares > 0 ? pool / shares : 0;

          let gain = -100;
          if (isTier1) gain = Math.min(Math.floor(shareValue), 800);
          else if (isTier2) gain = Math.min(Math.floor(shareValue / 2), 600);

          EV += p * gain;
        });

        // Calculate win probability and estimated payouts for display
        let winProb = 0;
        let tier1Payout = 0;
        let tier2Payout = 0;

        allOutcomes.forEach(outcome => {
          let p = 1;
          for (let i = 0; i < 4; i++) {
            const gameOutcome = outcome[i];
            if (gameOutcome === 'P') {
              p *= winProbs[i][2];
            } else {
              p *= winProbs[i][+gameOutcome];
            }
          }

          const matches = calculateMatches(userPick, outcome);
          if (matches === 4) {
            winProb += p;
          }
        });

        // Calculate average payouts (simplified for display)
        const avgShares = counts[userPick] + 0.5 * userCombos.reduce((sum, c) => {
          return sum + (calculateMatches(c, userPick) === 3 ? (counts[c] || 0) : 0);
        }, 0);
        
        if (avgShares > 0) {
          const avgShareValue = (100 * totalEntrants) / avgShares;
          tier1Payout = Math.min(Math.floor(avgShareValue), 800);
          tier2Payout = Math.min(Math.floor(avgShareValue / 2), 600);
        }

        results.push({ 
          combo: userPick, 
          ev: EV, 
          pickProb: pickProb, 
          estCount: Math.round(pickProb * totalEntrants),
          tier1Payout: tier1Payout,
          tier2Payout: tier2Payout,
          winProb: winProb
        });
      });

      results.sort((a, b) => b.ev - a.ev);

      const table = `
        <table>
          <tr><th>Picks</th><th>Win Probability</th><th>Selections</th><th>3/4 Payout (karma)</th><th>4/4 Payout (karma)</th><th>Expected Value (karma) ↓</th></tr>
          ${results.map((r) => {
            const readable = r.combo.split('').map(v => v === '0' ? 'L' : 'R').join('');
            const evClass = r.ev > 0 ? 'ev-positive' : 'ev-negative';
            
            return `<tr>
              <td>${readable}</td>
              <td>${(r.winProb * 100).toFixed(2)}%</td>
              <td>${r.estCount}</td>
              <td>${r.tier2Payout}</td>
              <td>${r.tier1Payout}</td>
              <td class="${evClass}">${r.ev.toFixed(2)}</td>
            </tr>`;
          }).join('')}
        </table>
      `;

      const copyButton = `<button class="copy-btn" onclick="copyTableData()">Copy Results</button>`;
      document.getElementById('results').innerHTML = table + copyButton;
      document.getElementById('results-container').style.display = 'block';
      
      if (showExtras) {
        const extraTable = `
          <table>
            <tr><th>Game</th><th>Type</th><th>L Win %</th><th>R Win %</th><th>Push %</th><th>L Odds</th><th>R Odds</th></tr>
            ${extraData.map((row, i) => {
              if (row.type === '0.0') {
                return `<tr><td>${i + 1}</td><td>.0 Spread</td>
                        <td>${row.winL.toFixed(1)}%</td><td>${row.winR.toFixed(1)}%</td>
                        <td>${row.pushProb.toFixed(1)}%</td><td>${row.oddsL}</td><td>${row.oddsR}</td></tr>`;
              } else {
                return `<tr><td>${i + 1}</td><td>.5 Spread</td>
                        <td>${(row.probL * 100).toFixed(1)}%</td><td>${(row.probR * 100).toFixed(1)}%</td>
                        <td>0.0%</td><td>${row.lOdds}</td><td>${row.rOdds}</td></tr>`;
              }
            }).join('')}
          </table>
        `;
        document.getElementById('extras').innerHTML = extraTable;
        document.getElementById('extras-container').style.display = 'block';
      } else {
        document.getElementById('extras-container').style.display = 'none';
      }

      window.lastResults = results;
    }

    function copyTableData() {
      const results = window.lastResults;
      if (!results) return;
      
      const copyText = results.map(r => {
        const readable = r.combo.split('').map(v => v === '0' ? 'L' : 'R').join('');
        
        // Calculate 3/4+ probability for this combo
        let prob3Plus = 0;
        const allOutcomes = generateAllOutcomes(window.gameTypes || ['0.5', '0.5', '0.5', '0.5']);
        
        allOutcomes.forEach(outcome => {
          let outcomeProb = 1;
          for (let i = 0; i < 4; i++) {
            const gameOutcome = outcome[i];
            if (gameOutcome === 'P') {
              outcomeProb *= window.winProbs[i][2]; // Push probability
            } else {
              outcomeProb *= window.winProbs[i][+gameOutcome];
            }
          }
          const match = calculateMatches(r.combo, outcome);
          if (match >= 3) prob3Plus += outcomeProb;
        });
        
        return `${readable} - ${(prob3Plus * 100).toFixed(2)}% - (${r.ev.toFixed(2)})`;
      }).join('\n');
      
      navigator.clipboard.writeText(copyText).then(() => {
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = 'Copied!';
        btn.style.background = 'linear-gradient(45deg, #059669, #047857)';
        setTimeout(() => {
          btn.textContent = originalText;
          btn.style.background = 'linear-gradient(45deg, #10b981, #059669)';
        }, 1500);
      });
    }

    function autofillRightPercents() {
      for (let i = 0; i < 4; i++) {
        const leftVal = parseFloat(document.getElementById(`pickL${i}`).value) || 0;
        const rightInput = document.getElementById(`pickR${i}`);
        rightInput.value = (100 - leftVal).toFixed(0);
      }
    }

  </script>
</body>
</html>
