<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pool EV Calculator (No-Vig + Push)</title>
  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: monospace;
      padding: 20px;
    }
    input, select {
      margin: 2px;
      width: 60px;
    }
    .game {
      margin-bottom: 10px;
    }
    button {
      margin-top: 10px;
      background: #0f0;
      color: #000;
      font-weight: bold;
      padding: 5px 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>Pool EV Calculator</h2>
  <div id="games"></div>
  <button onclick="calculateEV()">Calculate EV</button>
  <pre id="output"></pre>

  <script>
    const games = 4;
    const container = document.getElementById('games');

    for (let i = 0; i < games; i++) {
      const div = document.createElement('div');
      div.className = 'game';
      div.innerHTML = `
        <b>Game ${i + 1}</b><br>
        Spread: 
        <select id="spread${i}">
          <option value="0.5">.5</option>
          <option value="0.0">.0</option>
        </select><br>
        Left Win %: <input type="number" id="left${i}" value="50">
        Right Win %: <input type="number" id="right${i}" value="50"><br>
        % Picking Right Side: <input type="number" id="picked${i}" value="50">
      `;
      container.appendChild(div);
    }

    function calculateEV() {
      const gameData = [];

      for (let i = 0; i < games; i++) {
        const spreadType = document.getElementById(`spread${i}`).value;
        const leftRaw = parseFloat(document.getElementById(`left${i}`).value);
        const rightRaw = parseFloat(document.getElementById(`right${i}`).value);
        const pickedRight = parseFloat(document.getElementById(`picked${i}`).value) / 100;

        const total = leftRaw + rightRaw;
        if (total === 0) {
          alert(`Game ${i + 1}: Left + Right win probabilities must be greater than 0`);
          return;
        }

        const leftProb = leftRaw / total;
        const rightProb = rightRaw / total;
        const pushProb = (spreadType === "0.0") ? 1 - (leftProb + rightProb) : 0;

        gameData.push({ spreadType, leftProb, rightProb, pushProb, pickedRight });
      }

      const outcomes = generateOutcomes(gameData.map(g => g.spreadType));
      let ev = 0;

      for (const outcome of outcomes) {
        let prob = 1;
        let correctPicks = 0;

        for (let i = 0; i < games; i++) {
          const game = gameData[i];
          const result = outcome[i];

          if (result === 'L') {
            prob *= game.leftProb;
            correctPicks += 1 - game.pickedRight; // Left pickers correct
          } else if (result === 'R') {
            prob *= game.rightProb;
            correctPicks += game.pickedRight; // Right pickers correct
          } else if (result === 'P') {
            prob *= game.pushProb;
            correctPicks += 1; // Everyone correct on push
          }
        }

        ev += prob * correctPicks;
      }

      const avgEV = (ev).toFixed(2);
      document.getElementById('output').textContent = `Expected Correct Picks: ${avgEV}`;
    }

    function generateOutcomes(spreadTypes) {
      const results = [];

      function backtrack(path, index) {
        if (index === spreadTypes.length) {
          results.push([...path]);
          return;
        }
        const spread = spreadTypes[index];
        const options = spread === "0.0" ? ['L', 'R', 'P'] : ['L', 'R'];
        for (const opt of options) {
          path.push(opt);
          backtrack(path, index + 1);
          path.pop();
        }
      }

      backtrack([], 0);
      return results;
    }
  </script>
</body>
</html>
