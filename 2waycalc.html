<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>2-way Ev Calc</title>
  <style>
    body{font-family:sans-serif;margin:20px;background:#000;color:#ccc;text-align:center}
    input,button,select{margin:5px;padding:15px;font-size:16px;border-radius:25px;border:2px solid #ccc;transition:.3s}
    input,select{background:#333;color:#ccc;border:2px solid #555}
    input:focus,button:focus,select:focus{border-color:#07f;outline:0}
    button{cursor:pointer;background:#6f42c1;color:#fff;border:0}
    button:hover{background:#5a32a3}
    #clearButton{background:red;margin-left:10px}
    .real-odds{display:none}
    a{color:#858bf0}
    .highest-ev{color:#4CAF50;font-weight:bold}
    .history-section{margin:30px auto 0;max-width:800px;text-align:left}
    .history-item{background:#222;border:1px solid #444;border-radius:10px;padding:15px;margin:10px 0;position:relative}
    .history-timestamp{color:#888;font-size:12px;margin-bottom:10px}
    .copy-button{position:absolute;top:10px;right:10px;padding:5px 10px;font-size:12px;background:#28a745;border-radius:15px}
    .copy-button:hover{background:#218838}
    .history-content{font-family:monospace;font-size:14px;line-height:1.4}
    .clear-history-btn{background:#dc3545;margin-top:10px}
    .clear-history-btn:hover{background:#c82333}
    #historySection{display:none}
  </style>
</head>
<body>
  <h1>EV Calc</h1>
  <label><input type="checkbox" id="toggleRealOddsCheckbox">Show Real Odds Inputs</label><br>
  <label><input type="checkbox" id="toggleOutput">Show All Outputs</label><br>
  <label><input type="checkbox" id="toggleHistory">Show History</label><br>
  <label>Name Presets:</label>
  <select name="namePreset" id="namePresetSelect" onchange="changeName()">
    <option value="team" selected>Team 1/2</option>
    <option value="score">Over/Under</option>
    <option value="nrfi">Yes/No</option>
  </select><br>
  <input type="text" id="sportsbookOddsInput1" placeholder="Enter Team 1 American Odds (e.g., +150)"><br>
  <input type="text" id="sportsbookOddsInput2" placeholder="Enter Team 2 American Odds (e.g., -120)"><br>
  <div class="real-odds" id="realOddsInputs">
    <input type="text" id="realOddsInput1" placeholder="Enter Team 1 Real Odds" disabled><br>
    <input type="text" id="realOddsInput2" placeholder="Enter Team 2 Real Odds" disabled><br>
  </div>
  <select id="maxBetInput">
    <option value="50-5">50 (payout 5)</option>
    <option value="50-10">50 (payout 10)</option>
    <option value="100-10" selected>100</option>
    <option value="100-5">100 (payout 5)</option>
    <option value="200">200</option>
    <option value="300">300</option>
  </select>
  <label for="maxBetInput">Max Bet Amount</label><br>
  <button onclick="calculateNoVigOdds()">Calculate</button>
  <button id="clearButton" onclick="clearInputs()">Clear</button><br><br>
  <p id="result"></p>
  <div id="historySection" class="history-section">
    <h2>Calculation History</h2>
    <button class="clear-history-btn" onclick="clearHistory()">Clear History</button>
    <div id="historyContainer"></div>
  </div>
  <button onclick="window.location.href='index.html'">Go Home</button><br><br>
  <p>designed by @tomfc on Real</p>
  <script>
    const $ = id => document.getElementById(id),
      q = s => document.querySelector(s),
      inputs = ['sportsbookOddsInput1','sportsbookOddsInput2','realOddsInput1','realOddsInput2'],
      round = Math.round,
      to2 = v => round(v*100)/100,
      parseOdds = i => (v=parseInt($(i).value))&&v!==0?v:null,
      imP = o => o>0?100/(100+o):Math.abs(o)/(Math.abs(o)+100),
      fracP = o => `${round(o>0?100:Math.abs(o))}/${round(o>0?100+o:100-o)}`,
      amToDec = a => a>0?a/100+1:100/Math.abs(a)+1,
      realOdds = (i,d=100)=>$(i).value?parseOdds(i)||d:d,
      payout = (r,w)=>{
        let m=$('maxBetInput').value;w=+w;
        let win=(m=="50-5"||m=="100-5")?5:10;
        if(!w)win=r>0?round(win/100*r):round(100/Math.abs(r)*win);
        else win=r>0?w/100*r:100/Math.abs(r)*w;
        return round(win);
      },
      expV = (w,pw,wa,pl)=>to2(w*pw-wa*pl);

    function getNameLabels() {
        var preset = $('namePresetSelect').value;
        if (preset === "team") {
            return ["Team 1", "Team 2"];
        } else if (preset === "score") {
            return ["Over", "Under"];
        } else if (preset === "nrfi") {
            return ["Yes", "No"];
        }
        return ["Side 1", "Side 2"]; // fallback
    }

    function changeName(){
        var preset = $('namePresetSelect').value;
        var labels = getNameLabels();
        
        if (preset === "team") {
            $('sportsbookOddsInput1').placeholder = 'Enter Team 1 American Odds (e.g., +150)';
            $('sportsbookOddsInput2').placeholder = 'Enter Team 2 American Odds (e.g., -120)';
            $('realOddsInput1').placeholder = 'Enter Team 1 Real Odds';
            $('realOddsInput2').placeholder = 'Enter Team 2 Real Odds';
        } else if (preset === "score") {
            $('sportsbookOddsInput1').placeholder = 'Enter Over American Odds (e.g., +150)';
            $('sportsbookOddsInput2').placeholder = 'Enter Under American Odds (e.g., -120)';
            $('realOddsInput1').placeholder = 'Enter Over Real Odds';
            $('realOddsInput2').placeholder = 'Enter Under Real Odds';
        } else if (preset === "nrfi") {
            $('sportsbookOddsInput1').placeholder = 'Enter Yes American Odds (e.g., +150)';
            $('sportsbookOddsInput2').placeholder = 'Enter No American Odds (e.g., -120)';
            $('realOddsInput1').placeholder = 'Enter Yes Real Odds';
            $('realOddsInput2').placeholder = 'Enter No Real Odds';
        }
    }

    function toggleRealOddsInputs(){
      let show=$('toggleRealOddsCheckbox').checked;
      ['realOddsInput1','realOddsInput2'].forEach(i=>{ $(i).disabled=!show; });
      $('realOddsInputs').style.display=show?'block':'none';
    }
    function toggleHistorySection(){
      let show=$('toggleHistory').checked;
      $('historySection').style.display=show?'block':'none';
      if(show) updateHistoryDisplay();
    }
    function saveToHistory(calc){
      let h=getHistory();
      h.unshift({...calc,timestamp:new Date().toLocaleString()});
      if(h.length>50) h=h.slice(0,50);
      localStorage.setItem('evCalcHistory',JSON.stringify(h));
      updateHistoryDisplay();
    }
    function getHistory(){
      try{return JSON.parse(localStorage.getItem('evCalcHistory')||'[]');}catch(e){return [];}
    }
    function clearHistory(){localStorage.removeItem('evCalcHistory');updateHistoryDisplay();}
    function updateHistoryDisplay(){
      let h=getHistory(),c=$('historyContainer');
      if(!h.length){ c.innerHTML='<p>No calculations yet.</p>'; return;}
      c.innerHTML=h.map((calc,i)=>`
        <div class="history-item">
          <button class="copy-button" onclick="copyToClipboard(${i})">Copy</button>
          <div class="history-timestamp">${calc.timestamp}</div>
          <div class="history-content">${formatCalculationForDisplay(calc)}</div>
        </div>
      `).join('');
    }
    function formatCalculationForDisplay(c){
      // Use the labels stored in the calculation, or fallback to generic names
      var label1 = c.label1 || "Side 1";
      var label2 = c.label2 || "Side 2";
      
      return [
        `Sportsbook Odds: ${c.sportsbookOdds1} vs ${c.sportsbookOdds2}`,
        `Real Odds: ${c.realOdds1} vs ${c.realOdds2}`,
        `Max Bet: ${c.maxBet}`,
        ``,
        `No-Vig Probabilities:`,
        `&nbsp;&nbsp;${label1}: ${c.noVigProb1} (${c.fractionalProb1})`,
        `&nbsp;&nbsp;${label2}: ${c.noVigProb2} (${c.fractionalProb2})`,
        ``,
        `Payouts:`,
        `&nbsp;&nbsp;${label1} (Wager 0): ${c.winnings1Wager0}`,
        `&nbsp;&nbsp;${label1} (Max Bet): ${c.winnings1WagerMax}`,
        `&nbsp;&nbsp;${label2} (Wager 0): ${c.winnings2Wager0}`,
        `&nbsp;&nbsp;${label2} (Max Bet): ${c.winnings2WagerMax}`,
        ``,
        `Expected Values:`,
        `&nbsp;&nbsp;${label1} (Wager 0): ${c.ev1Wager0}${c.ev1Wager0===c.maxEV?' ✅ BEST':''}`,
        `&nbsp;&nbsp;${label1} (Max Bet): ${c.ev1WagerMax}${c.ev1WagerMax===c.maxEV?' ✅ BEST':''}`,
        `&nbsp;&nbsp;${label2} (Wager 0): ${c.ev2Wager0}${c.ev2Wager0===c.maxEV?' ✅ BEST':''}`,
        `&nbsp;&nbsp;${label2} (Max Bet): ${c.ev2WagerMax}${c.ev2WagerMax===c.maxEV?' ✅ BEST':''}`
      ].join('<br>');
    }

    function formatCalculationForHistory(c){
      // Use the labels stored in the calculation, or fallback to generic names
      var label1 = c.label1 || "Side 1";
      var label2 = c.label2 || "Side 2";
      
      return [
        `Sportsbook Odds: ${c.sportsbookOdds1} vs ${c.sportsbookOdds2}`,
        `Real Odds: ${c.realOdds1} vs ${c.realOdds2}`,
        `Max Bet: ${c.maxBet}`,
        ``,
        `No-Vig Probabilities:`,
        `  ${label1}: ${c.noVigProb1} (${c.fractionalProb1})`,
        `  ${label2}: ${c.noVigProb2} (${c.fractionalProb2})`,
        ``,
        `Payouts:`,
        `  ${label1} (Wager 0): ${c.winnings1Wager0}`,
        `  ${label1} (Max Bet): ${c.winnings1WagerMax}`,
        `  ${label2} (Wager 0): ${c.winnings2Wager0}`,
        `  ${label2} (Max Bet): ${c.winnings2WagerMax}`,
        ``,
        `Expected Values:`,
        `  ${label1} (Wager 0): ${c.ev1Wager0}${c.ev1Wager0===c.maxEV?' ✅ BEST':''}`,
        `  ${label1} (Max Bet): ${c.ev1WagerMax}${c.ev1WagerMax===c.maxEV?' ✅ BEST':''}`,
        `  ${label2} (Wager 0): ${c.ev2Wager0}${c.ev2Wager0===c.maxEV?' ✅ BEST':''}`,
        `  ${label2} (Max Bet): ${c.ev2WagerMax}${c.ev2WagerMax===c.maxEV?' ✅ BEST':''}`
      ].join('\n');
    }
    function copyToClipboard(i){
      let h=getHistory(),c=h[i],txt=formatCalculationForHistory(c),btn=event.target,old=btn.textContent;
      navigator.clipboard.writeText(txt).then(()=>{
        btn.textContent='Copied!';btn.style.background='#28a745';
        setTimeout(()=>{btn.textContent=old;btn.style.background='';},1e3);
      }).catch(()=>{
        let t=document.createElement('textarea');
        t.value=txt;document.body.appendChild(t);t.select();document.execCommand('copy');document.body.removeChild(t);
        btn.textContent='Copied!';setTimeout(()=>{btn.textContent=old;},1e3);
      });
    }
    function calculateNoVigOdds(){
      let sbo1=parseOdds('sportsbookOddsInput1'),sbo2=parseOdds('sportsbookOddsInput2');
      if(sbo1===null||sbo2===null){alert('Please enter valid American odds for both sides.');return;}
      
      let labels = getNameLabels();
      let ro1=realOdds('realOddsInput1'),ro2=realOdds('realOddsInput2'),
        maxBet=+$('maxBetInput').value.split('-')[0],
        prob1=imP(sbo1),prob2=imP(sbo2),tot=prob1+prob2,
        nvP1=prob1/tot,nvP2=prob2/tot,
        nvO1=nvP1<.5?round(100*(1-nvP1)/nvP1):-round(100*nvP1/(1-nvP1)),
        nvO2=nvP2<.5?round(100*(1-nvP2)/nvP2):-round(100*nvP2/(1-nvP2)),
        nvDP1=nvO1>0?100/(100+nvO1):Math.abs(nvO1)/(Math.abs(nvO1)+100),
        nvDP2=nvO2>0?100/(100+nvO2):Math.abs(nvO2)/(Math.abs(nvO2)+100),
        w1w0=payout(ro1,0),w1wm=payout(ro1,maxBet),
        w2w0=payout(ro2,0),w2wm=payout(ro2,maxBet),
        fp1=fracP(nvO1),fp2=fracP(nvO2),
        ev1w0=expV(w1w0,nvDP1,0,nvDP2),ev1wm=expV(w1wm,nvDP1,maxBet,nvDP2),
        ev2w0=expV(w2w0,nvDP2,0,nvDP1),ev2wm=expV(w2wm,nvDP2,maxBet,nvDP1),
        evs=[ev1w0,ev1wm,ev2w0,ev2wm],maxEV=Math.max(...evs),
        showAll=$('toggleOutput').checked;
      let calc={sportsbookOdds1:sbo1,sportsbookOdds2:sbo2,realOdds1:ro1,realOdds2:ro2,maxBet,noVigProb1:nvDP1.toFixed(4),noVigProb2:nvDP2.toFixed(4),fractionalProb1:fp1,fractionalProb2:fp2,winnings1Wager0:w1w0,winnings1WagerMax:w1wm,winnings2Wager0:w2w0,winnings2WagerMax:w2wm,ev1Wager0:ev1w0,ev1WagerMax:ev1wm,ev2Wager0:ev2w0,ev2WagerMax:ev2wm,maxEV,label1:labels[0],label2:labels[1]};
      saveToHistory(calc);
      let r='';
      if(showAll){
        r+=`${labels[0]} No-Vig American Odds: ${nvO1} (Decimal: ${amToDec(nvO1).toFixed(2)})<br>
        ${labels[1]} No-Vig American Odds: ${nvO2} (Decimal: ${amToDec(nvO2).toFixed(2)})<br>
        ${labels[0]} Winnings (Wager 0): ${w1w0}<br>
        ${labels[0]} Winnings (Max Bet): ${w1wm}<br>
        ${labels[1]} Winnings (Wager 0): ${w2w0}<br>
        ${labels[1]} Winnings (Max Bet): ${w2wm}<br>
        ${labels[0]} No-Vig Probability: ${nvP1.toFixed(4)}<br>
        ${labels[1]} No-Vig Probability: ${nvP2.toFixed(4)}<br>
        ${labels[0]} Fractional Probability: ${fp1}<br>
        ${labels[1]} Fractional Probability: ${fp2}<br>`;
      }
      r+=`<strong>${labels[0]} Expected Value (Wager 0): ${ev1w0}${ev1w0===maxEV?' ✅':''}</strong><br>
      <strong>${labels[0]} Expected Value (Max Bet): ${ev1wm}${ev1wm===maxEV?' ✅':''}</strong><br>
      <strong>${labels[1]} Expected Value (Wager 0): ${ev2w0}${ev2w0===maxEV?' ✅':''}</strong><br>
      <strong>${labels[1]} Expected Value (Max Bet): ${ev2wm}${ev2wm===maxEV?' ✅':''}</strong><br>`;
      $('result').innerHTML=r;
    }
    function clearInputs(){
      inputs.forEach(i=>$(i).value='');
      $('maxBetInput').value='100-10';
      $('toggleOutput').checked=false;
      $('toggleRealOddsCheckbox').checked=false;
      $('result').innerHTML='';
      toggleRealOddsInputs();
    }
    window.addEventListener('DOMContentLoaded',()=>{
      toggleRealOddsInputs();
      $('toggleRealOddsCheckbox').onchange=toggleRealOddsInputs;
      $('toggleHistory').onchange=toggleHistorySection;
      updateHistoryDisplay();
    });

    document.getElementById("namePresetSelect").value = "team"; 
  </script>
</body>
</html>
