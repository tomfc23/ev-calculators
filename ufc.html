<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UFC EV Calculator</title>
<style>
body {
font-family: Arial, sans-serif;
margin: 0;
padding: 20px;
background: #0a0a0a;
min-height: 100vh;
 }
h1 {
text-align: center;
color: #ffffff;
margin-bottom: 10px;
 }
.subtitle {
text-align: center;
color: #888888;
margin-bottom: 30px;
font-style: italic;
 }
.main-container {
max-width: 900px;
margin: 0 auto;
background: #1a1a1a;
padding: 30px;
border-radius: 10px;
box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
border: 1px solid #333333;
 }
.toggle-section {
text-align: center;
margin-bottom: 30px;
padding: 20px;
background: #222222;
border-radius: 8px;
border: 1px solid #333333;
}
.toggle-section h3 {
color: #8a2be2;
margin-bottom: 15px;
}
.toggle-buttons {
display: flex;
justify-content: center;
gap: 10px;
}
.toggle-btn {
background: #333333;
color: white;
padding: 10px 20px;
border: 1px solid #8a2be2;
border-radius: 5px;
font-size: 16px;
cursor: pointer;
transition: all 0.3s ease;
}
.toggle-btn.active {
background: #8a2be2;
}
.toggle-btn:hover {
background: #444444;
}
.toggle-btn.active:hover {
background: #9a3bef;
}
.section-title {
text-align: center;
color: #ffffff;
margin-bottom: 20px;
font-size: 24px;
border-bottom: 2px solid #8a2be2;
padding-bottom: 10px;
 }
.round-section {
margin: 20px 0;
padding: 20px;
background: #222222;
border-radius: 8px;
border-left: 4px solid #8a2be2;
 }
.round-title {
font-size: 18px;
font-weight: bold;
color: #ffffff;
margin-bottom: 15px;
 }
.input-row {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 15px;
margin-bottom: 10px;
 }
.input-group {
display: flex;
flex-direction: column;
 }
label {
font-weight: bold;
margin-bottom: 5px;
color: #cccccc;
font-size: 12px;
 }
input[type="text"], input[type="number"] {
padding: 10px;
border: 1px solid #333333;
border-radius: 5px;
font-size: 16px;
background: #1a1a1a;
color: #ffffff;
 }
input[type="text"]:focus, input[type="number"]:focus {
border-color: #8a2be2;
outline: none;
 }
.checkbox-section {
margin: 20px 0;
padding: 15px;
background: #222222;
border-radius: 5px;
text-align: center;
 }
.checkbox-section label {
color: #ffffff;
font-size: 14px;
 }
button {
background: #333333;
color: white;
padding: 15px 30px;
border: 1px solid #8a2be2;
border-radius: 5px;
font-size: 18px;
cursor: pointer;
margin: 20px auto;
display: block;
width: 300px;
 }
button:hover {
background: #444444;
 }
.home-btn {
background: #8a2be2;;
border: 1px solid #8a2be2;;
width: 200px;
margin-top: 30px;
}
.home-btn:hover {
background: #943ae8;;
}
.results {
background: #1a1a1a;
padding: 20px;
border-radius: 8px;
margin-top: 20px;
border: 1px solid #333333;
 }
.ev-results {
margin-top: 20px;
 }
.ev-results h3 {
color: #8a2be2;
border-bottom: 2px solid #8a2be2;
padding-bottom: 10px;
 }
.ev-item {
background-color: #222222;
padding: 15px;
margin: 10px 0;
border-radius: 5px;
border-left: 4px solid #8a2be2;
font-weight: bold;
color: #ffffff;
display: flex;
justify-content: space-between;
align-items: center;
 }
.positive-ev {
border-left-color: #28a745 !important;
background-color: #1a2e1a !important;
color: #28a745 !important;
 }
.negative-ev {
border-left-color: #dc3545 !important;
background-color: #2e1a1a !important;
color: #dc3545 !important;
 }
.prob-section, .payout-section {
margin-top: 20px;
padding: 15px;
background-color: #222222;
border-radius: 5px;
border: 1px solid #333333;
color: #ffffff;
 }
.prob-section h4, .payout-section h4 {
color: #8a2be2;
margin-bottom: 10px;
border-bottom: 1px solid #8a2be2;
padding-bottom: 5px;
 }
.prob-grid, .payout-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 10px;
 }
.prob-item, .payout-item {
text-align: center;
padding: 10px;
background-color: #1a1a1a;
border-radius: 4px;
border: 1px solid #333333;
 }
.prob-label, .payout-label {
font-size: 12px;
color: #888888;
margin-bottom: 5px;
 }
.prob-value, .payout-value {
font-size: 14px;
font-weight: bold;
color: #ffffff;
 }
@media (max-width: 768px) {
.input-row {
grid-template-columns: 1fr;
gap: 10px;
 }
.prob-grid, .payout-grid {
grid-template-columns: 1fr;
 }
.toggle-buttons {
flex-direction: column;
align-items: center;
}
 }
</style>
</head>
<body>
<div class="main-container">
<h1>UFC EV Calculator</h1>
<p class="subtitle">Instructions on guide on homepage</p>

<div class="toggle-section">
<h3>Fight Duration</h3>
<div class="toggle-buttons">
<button class="toggle-btn" id="toggle3" onclick="toggleRounds(3)">3 Rounds</button>
<button class="toggle-btn active" id="toggle5" onclick="toggleRounds(5)">5 Rounds</button>
</div>
</div>

<div class="round-section">
<div class="round-title">Round 1</div>
<div class="input-row">
<div class="input-group"></div>
<div class="input-group"></div>
<div class="input-group">
<label>Round 1 Real App Odds</label>
<input type="number" id="r1finish" placeholder="e.g., 250">
</div>
</div>
</div>

<div class="round-section">
<div class="round-title">Round 2</div>
<div class="input-row">
<div class="input-group">
<label>Sportsbook Odds (Reaches R2)</label>
<input type="text" id="r2yes" placeholder="e.g., +150 or -200">
</div>
<div class="input-group">
<label>Sportsbook Odds (Doesn't Reach R2)</label>
<input type="text" id="r2no" placeholder="e.g., +150 or -200">
</div>
<div class="input-group">
<label>Round 2 Real App Odds</label>
<input type="number" id="r2finish" placeholder="e.g., 250">
</div>
</div>
</div>

<div class="round-section">
<div class="round-title">Round 3</div>
<div class="input-row">
<div class="input-group">
<label>Sportsbook Odds (Reaches R3)</label>
<input type="text" id="r3yes" placeholder="e.g., +150 or -200">
</div>
<div class="input-group">
<label>Sportsbook Odds (Doesn't Reach R3)</label>
<input type="text" id="r3no" placeholder="e.g., +150 or -200">
</div>
<div class="input-group">
<label>Round 3 Real App Odds</label>
<input type="number" id="r3finish" placeholder="e.g., 250">
</div>
</div>
</div>

<div class="round-section" id="round4">
<div class="round-title">Round 4</div>
<div class="input-row">
<div class="input-group">
<label>Sportsbook Odds (Reaches R4)</label>
<input type="text" id="r4yes" placeholder="e.g., +150 or -200">
</div>
<div class="input-group">
<label>Sportsbook Odds (Doesn't Reach R4)</label>
<input type="text" id="r4no" placeholder="e.g., +150 or -200">
</div>
<div class="input-group">
<label>Round 4 Real App Odds</label>
<input type="number" id="r4finish" placeholder="e.g., 250">
</div>
</div>
</div>

<div class="round-section" id="round5">
<div class="round-title">Round 5</div>
<div class="input-row">
<div class="input-group">
<label>Sportsbook Odds (Reaches R5)</label>
<input type="text" id="r5yes" placeholder="e.g., +150 or -200">
</div>
<div class="input-group">
<label>Sportsbook Odds (Doesn't Reach R5)</label>
<input type="text" id="r5no" placeholder="e.g., +150 or -200">
</div>
<div class="input-group">
<label>Round 5 Real App Odds</label>
<input type="number" id="r5finish" placeholder="e.g., 250">
</div>
</div>
</div>

<div class="checkbox-section">
<label>
<input type="checkbox" id="showDetails" style="margin-right: 10px;">
Show implied probabilities and payout details
</label>
</div>

<button onclick="calculateAll()">Calculate Expected Values</button>

<button onclick="clearAll()" style="background: #dc3545; border: 1px solid #dc3545; width: 200px; margin-top: 10px;">Clear</button>

<div id="results" class="results" style="display:none;"></div>


</div>
<button class="home-btn" onclick="goHome()">üè† Home</button>

<script>
let currentRounds = 5;

function toggleRounds(rounds) {
    currentRounds = rounds;
    
    // Update toggle button styles
    document.getElementById('toggle3').classList.remove('active');
    document.getElementById('toggle5').classList.remove('active');
    document.getElementById('toggle' + rounds).classList.add('active');
    
    // Show/hide round sections
    if (rounds === 3) {
        document.getElementById('round4').style.display = 'none';
        document.getElementById('round5').style.display = 'none';
    } else {
        document.getElementById('round4').style.display = 'block';
        document.getElementById('round5').style.display = 'block';
    }
    
    // Clear results if shown
    document.getElementById("results").style.display = 'none';
    autoSetOdds()
}

function goHome() {
    // You can customize this to navigate to your actual home page
    if (window.history.length > 1) {
        window.history.back();
    } else {
        // If no history, you can redirect to a specific URL
        // window.location.href = '/';
        alert('No previous page in history. Add your home page URL in the goHome() function.');
    }
}

// Improved implied probability calculations from the first file
function convertToImpliedProbability(odds) {
    if (odds >= 0) {
        return 100 / (odds + 100);
    } else {
        return Math.abs(odds) / (Math.abs(odds) + 100);
    }
}

function calculateNoVigProbability(yesOdds, noOdds) {
    const yesIP = convertToImpliedProbability(yesOdds);
    const noIP = convertToImpliedProbability(noOdds);
    return yesIP / (yesIP + noIP);
}

function calculateProfit(odds, bet) {
    if (odds > 0) {
        return (odds / 100) * bet;
    } else {
        return (100 / Math.abs(odds)) * bet;
    }
}

function calculateAll() {
    const betAmount = 100;
    const maxRounds = currentRounds;
    
    // Get inputs based on current round setting
    const inputs = {};
    const finishOdds = {};
    
    // Always need R1
    finishOdds[1] = Number(document.getElementById("r1finish").value);
    
    // Get inputs for rounds 2 through maxRounds
    for (let i = 2; i <= maxRounds; i++) {
        const yesInput = document.getElementById(`r${i}yes`);
        const noInput = document.getElementById(`r${i}no`);
        const finishInput = document.getElementById(`r${i}finish`);
        
        if (yesInput && noInput && finishInput) {
            inputs[`r${i}yes`] = parseFloat(yesInput.value);
            inputs[`r${i}no`] = parseFloat(noInput.value);
            finishOdds[i] = Number(finishInput.value);
        }
    }

    // Validate inputs
    for (let i = 2; i <= maxRounds; i++) {
        if (isNaN(inputs[`r${i}yes`]) || isNaN(inputs[`r${i}no`])) {
            alert(`Please enter valid sportsbook odds for round ${i}.`);
            return;
        }
    }

    for (let i = 1; i <= maxRounds; i++) {
        if (isNaN(finishOdds[i])) {
            alert(`Please enter valid app odds for round ${i} finish.`);
            return;
        }
    }

    // Calculate no-vig probabilities for reaching each round using improved method
    const novigReachProb = {};
    for (let i = 2; i <= maxRounds; i++) {
        novigReachProb[i] = calculateNoVigProbability(inputs[`r${i}yes`], inputs[`r${i}no`]);
    }

    // Calculate round finish probabilities using the same logic as the implied probability calculator
    const finishProb = {};
    
    if (maxRounds === 3) {
        finishProb[1] = 1 - novigReachProb[2];
        finishProb[2] = novigReachProb[2] - novigReachProb[3];
        finishProb[3] = novigReachProb[3];
    } else {
        finishProb[1] = 1 - novigReachProb[2];
        finishProb[2] = novigReachProb[2] - novigReachProb[3];
        finishProb[3] = novigReachProb[3] - novigReachProb[4];
        finishProb[4] = novigReachProb[4] - novigReachProb[5];
        finishProb[5] = novigReachProb[5];
    }

    // Validate that all finish probabilities are non-negative
    for (let i = 1; i <= maxRounds; i++) {
        if (finishProb[i] < 0) {
            alert(`Error: Negative probability calculated for Round ${i}. Please check your input odds for consistency.`);
            return;
        }
    }

    // Calculate payouts and EVs
    const payouts = {};
    const evs = {};
    
    for (let i = 1; i <= maxRounds; i++) {
        payouts[i] = calculateProfit(finishOdds[i], betAmount);
        evs[i] = (finishProb[i] * payouts[i]) - ((1 - finishProb[i]) * betAmount);
    }

    // Check if details should be shown
    const showDetails = document.getElementById("showDetails").checked;

    // Find the best EV
    const evValues = Object.values(evs);
    const maxEV = Math.max(...evValues);

    // Helper function to get EV class
    function getEVClass(ev) {
        if (ev > 0) return 'positive-ev';
        if (ev < 0) return 'negative-ev';
        return '';
    }

    // Build results HTML
    let resultsHTML = `
        <div class="ev-results">
            <h3>Expected Value Analysis (${maxRounds} Rounds)</h3>
    `;
    
    for (let i = 1; i <= maxRounds; i++) {
        const isLastRound = i === maxRounds;
        const roundLabel = isLastRound ? `Round ${i}+ / Decision` : `Round ${i} Finish`;
        resultsHTML += `
            <div class="ev-item ${getEVClass(evs[i])}">
                <span>${roundLabel} ${evs[i] === maxEV ? '‚úÖ' : ''}</span>
                <span>${evs[i].toFixed(2)}</span>
            </div>
        `;
    }
    
    resultsHTML += '</div>';

    if (showDetails) {
        resultsHTML += `
            <div class="prob-section">
                <h4>No-Vig Round Finish Probabilities</h4>
                <div class="prob-grid">
        `;
        
        let totalProb = 0;
        for (let i = 1; i <= maxRounds; i++) {
            totalProb += finishProb[i];
            const isLastRound = i === maxRounds;
            const roundLabel = isLastRound ? `Round ${i}+ / Decision` : `Round ${i} Finish`;
            resultsHTML += `
                <div class="prob-item">
                    <div class="prob-label">${roundLabel}</div>
                    <div class="prob-value">${(finishProb[i] * 100).toFixed(2)}%</div>
                </div>
            `;
        }
        
        resultsHTML += `
                    <div class="prob-item">
                        <div class="prob-label">Total</div>
                        <div class="prob-value">${(totalProb * 100).toFixed(2)}%</div>
                    </div>
                </div>
            </div>

            <div class="payout-section">
                <h4>Payout Analysis (100 karma bets)</h4>
                <div class="payout-grid">
        `;
        
        for (let i = 1; i <= maxRounds; i++) {
            const isLastRound = i === maxRounds;
            const roundLabel = isLastRound ? `Round ${i}+ / Decision` : `Round ${i} Finish`;
            resultsHTML += `
                <div class="payout-item">
                    <div class="payout-label">${roundLabel}</div>
                    <div class="payout-value">${payouts[i].toFixed(2)} karma</div>
                </div>
            `;
        }
        
        resultsHTML += `
                </div>
            </div>
        `;
    }

    document.getElementById("results").innerHTML = resultsHTML;
    document.getElementById("results").style.display = 'block';
}

function clearAll() {
    // Clear all input fields
    document.getElementById('r1finish').value = '';
    document.getElementById('r2yes').value = '';
    document.getElementById('r2no').value = '';
    document.getElementById('r2finish').value = '';
    document.getElementById('r3yes').value = '';
    document.getElementById('r3no').value = '';
    document.getElementById('r3finish').value = '';
    document.getElementById('r4yes').value = '';
    document.getElementById('r4no').value = '';
    document.getElementById('r4finish').value = '';
    document.getElementById('r5yes').value = '';
    document.getElementById('r5no').value = '';
    document.getElementById('r5finish').value = '';
    
    // Hide results
    document.getElementById("results").style.display = 'none';
    
    // Uncheck the details checkbox
    document.getElementById("showDetails").checked = false;
}

function autoSetOdds(){
    if (currentRounds == 5) {
        document.getElementById('r1finish').value = '350';
        document.getElementById('r2finish').value = '300';
        document.getElementById('r3finish').value = '250';
        document.getElementById('r4finish').value = '200';
        document.getElementById('r5finish').value = '150';
    }else if (currentRounds == 3){
        document.getElementById('r1finish').value = '250';
        document.getElementById('r2finish').value = '200';
        document.getElementById('r3finish').value = '150';
    }else{
        alert("error")
    }
}

// Initialize with 5 rounds
toggleRounds(5);
autoSetOdds()
</script>
</body>
</html>
